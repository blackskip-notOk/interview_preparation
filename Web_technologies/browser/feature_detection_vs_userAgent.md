# **feature detection vs userAgent**

В современном вебе используются две основные технологии определения возможностей браузера:

* распарсить user_agent, определить версию браузера и писать в коде свитчи по версии браузера;
* пытаться определять поддержку фич путём проверки нужных полей / вызовов нужных методов.

Исторически сложилось так, что второй вариант считается более `true`, и именно его реализуют все современные проекты:

* не нужно хранить базу регулярок
* если в каком-то браузере появляется новая фича, она начинает работать автоматически без изменения кода
* неизвестные (экзотические, новые) браузеры будут работать без дополнительных телодвижений
* если у пользователя подменён user_agent, то код всё равно будет работать.

У этого подхода возникают неразрешимые сложности, когда та или иная фича детектится, но не работает. В идеальном мире если в браузере реализована какая-то фича, то она работает. В реальном — может, работает, а может, и нет. И вообще, новая версия браузера может внезапно её сломать.
***

## **feature detection**

Определение возможностей браузера заключается в определении, поддерживает ли браузер определенный блок кода - и если нет, то будет выполняться другой код, так что браузер всегда сможет обеспечить работоспособность и предотвратить сбои/ошибки в некоторых браузерах.

````js
if ('geolocation' in navigator) {
  // Можно использовать navigator.geolocation
} else {
  // Обработка отсутствия возможности
}
````

***

## **feature inference**

Предположение возможностей проверяет на наличие определенных возможностей, как и предыдущий подход, но использует другую функцию, которая предполагает, что определенная возможность уже существует, например:

````js
if (document.getElementsByTagName) {
  element = document.getElementById(id);
}
````

***

## **userAgent**

Это строка, сообщаемая браузером, которая позволяет узлам сетевого протокола определить тип приложения, операционную систему, поставщика программного обеспечения или версию программного обеспечения пользователя от которого исходит запрос. Доступ к ней можно получить через `navigator.userAgent`. Тем не менее, строка `userAgent` сложна для обработки и может быть подделана. Например, браузер **Chrome** идентифицируется как **Chrome**, так и **Safari**. Таким образом, чтобы обнаружить браузер **Safari**, вы должны проверить на наличие строки **Safari** и отсутствие строки **Chrome**.

***

Итого, если в вашем проекте вы интенсивно используете новые фичи браузеров либо встраиваетесь на страницы с агрессивным пользовательским кодом — `feature detection` рано или поздно выйдет вам боком. Да, парсинг `userAgent` лишает вас части аудитории с нестандартными браузерами и переопределёнными юзер-агентами — но это измеримые риски. Для каждого нестандартного браузера вы можете посмотреть на его долю и решить, окупится ли его поддержка.
